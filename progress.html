<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progresso - Arkos Learning</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="progress.css">
</head>

<body>

    <section class="trilha">
        <!-- Controllable Character -->
        <div class="character-container">
            <div class="character" id="gameCharacter">
                <div class="character-body"></div>
                <div class="character-face">
                    <div class="eye left-eye"></div>
                    <div class="eye right-eye"></div>
                    <div class="mouth"></div>
                </div>
            </div>
        </div>
        <div class="trilha-container">
            <img src="images/mapa_atlantis.png" alt="Mapa do Atlantis" />
            <img src="images/mapa_cidade.png" alt="Mapa da Cidade" id="mapa_cidade" />
            <img src="images/mapa_dragoes.png" alt="Mapa do Deserto" />
            <img src="images/mapa_egito.png" alt="Mapa da Floresta" />
            <img src="images/mapa_futurista.png" alt="Mapa da Montanha" />
        </div>

    </section>



    <!-- Character Instructions -->
    <div class="character-instructions"></div>

    <script>
        // Character movement control based on scroll with auto-scroll
        document.addEventListener('DOMContentLoaded', function () {
            const character = document.getElementById('gameCharacter');
            const container = document.querySelector('.character-container');
            let currentPosition = 300; // Start at center in pixels
            let isMoving = false;


            // Movement speed and boundaries based on scroll width
            const moveSpeed = 20;
            const scrollTriggerDistance = 1000; // Distance from edge to trigger scroll

            function updateBoundaries() {
                const scrollWidth = document.documentElement.scrollWidth;
                const viewportWidth = window.innerWidth;
                return {
                    minPosition: 30, // 30px from left edge
                    maxPosition: Math.max(scrollWidth, viewportWidth) - 20 // 60px from right edge
                };
            }

            function autoScroll(direction) {
                const currentScrollLeft = window.pageXOffset || document.documentElement.scrollLeft;
                const viewportWidth = window.innerWidth;
                const maxScrollLeft = document.documentElement.scrollWidth - viewportWidth;

                if (direction === 'left') {
                    // Check if character is near left edge of viewport
                    const characterViewportPosition = currentPosition - currentScrollLeft;
                    if (characterViewportPosition <= scrollTriggerDistance && currentScrollLeft > 0) {
                        const newScrollLeft = Math.max(0, currentScrollLeft - moveSpeed);
                        window.scrollTo({ left: newScrollLeft, behavior: 'smooth' });
                    }
                } else if (direction === 'right') {
                    // Check if character is near right edge of viewport
                    const characterViewportPosition = currentPosition - currentScrollLeft;
                    pertoReino(characterViewportPosition);
                    if (characterViewportPosition >= (viewportWidth - scrollTriggerDistance) && currentScrollLeft < maxScrollLeft) {
                        const newScrollLeft = Math.min(maxScrollLeft, currentScrollLeft + moveSpeed);
                        window.scrollTo({ left: newScrollLeft, behavior: 'smooth' });
                    }
                }
            }

            let passouReinoCidade = false;
            function pertoReino(distancia) {
                console.log("pertoReino");
                const mapa_cidade = document.getElementById('mapa_cidade');
                const posicao = mapa_cidade.getBoundingClientRect();


                if (posicao.left < distancia + 256 && !passouReinoCidade) {
                    alert("Você está chegando na cidade");
                    passouReinoCidade = true
                }
            }

            function moveCharacter(direction) {
                const boundaries = updateBoundaries();

                if (direction === 'left' && currentPosition > boundaries.minPosition) {
                    currentPosition -= moveSpeed;
                    character.classList.add('moving-left');
                    character.classList.remove('moving-right');
                    autoScroll('left');
                } else if (direction === 'right' && currentPosition < boundaries.maxPosition) {
                    currentPosition += moveSpeed;
                    character.classList.add('moving-right');
                    character.classList.remove('moving-left');
                    autoScroll('right');
                }

                // Update position in pixels instead of percentage
                container.style.left = currentPosition + 'px';
                container.style.transform = 'translateX(0)';
            }

            function stopMoving() {
                isMoving = false;
                character.classList.remove('moving-left', 'moving-right');
            }

            // Initialize character position
            function initializePosition() {
                const boundaries = updateBoundaries();
                currentPosition = Math.min(currentPosition, boundaries.maxPosition);
                currentPosition = Math.max(currentPosition, boundaries.minPosition);
                container.style.left = currentPosition + 'px';
                container.style.transform = 'translateX(0)';
            }

            // Keyboard event listeners
            document.addEventListener('keydown', function (event) {
                switch (event.key) {
                    case 'ArrowLeft':
                        event.preventDefault();
                        moveCharacter('left');
                        isMoving = true;
                        break;
                    case 'ArrowRight':
                        event.preventDefault();
                        moveCharacter('right');
                        isMoving = true;
                        break;
                    case 'ArrowUp':
                    case ' ': // Spacebar
                        event.preventDefault();
                        character.classList.add('jumping');
                        setTimeout(() => {
                            character.classList.remove('jumping');
                        }, 500);
                        break;
                }
            });

            document.addEventListener('keyup', function (event) {
                if (event.key === 'ArrowLeft' || event.key === 'ArrowRight') {
                    stopMoving();
                }
            });

            // Touch controls for mobile
            let touchStartX = 0;

            document.addEventListener('touchstart', function (event) {
                touchStartX = event.touches[0].clientX;
            });

            document.addEventListener('touchmove', function (event) {
                event.preventDefault();
                const touchCurrentX = event.touches[0].clientX;
                const diff = touchCurrentX - touchStartX;

                if (Math.abs(diff) > 10) {
                    if (diff > 0) {
                        moveCharacter('right');
                    } else {
                        moveCharacter('left');
                    }
                    touchStartX = touchCurrentX;
                }
            });

            document.addEventListener('touchend', function () {
                stopMoving();
            });

            // Handle window resize
            window.addEventListener('resize', function () {
                initializePosition();
            });

            // Handle manual scrolling to keep character in sync
            window.addEventListener('scroll', function () {
                // Optional: Add logic here if you want to adjust character position during manual scroll
            });

            // Initialize
            initializePosition();
        });
    </script>


    <script src="script.js"></script>
    <script src="progress.js"></script>
</body>

</html>